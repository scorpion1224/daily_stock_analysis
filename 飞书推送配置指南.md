# 🎯 飞书每日定时推送配置指南

本指南将帮助您配置A股智能分析系统的飞书每日定时推送功能。

## 📝 功能特点

1. **自动分析**：每日定时分析自选股和市场行情
2. **智能决策**：基于AI模型提供买卖建议和目标价位
3. **多方式推送**：
   - 🔔 **飞书机器人**：快速消息提醒
   - 📄 **飞书文档**：详细分析报告（避免长度限制）
4. **灵活配置**：支持GitHub Actions（免费）或本地定时运行

## ⚙️ 配置步骤

### 第一步：GitHub Actions 配置（推荐）

1. **Fork 本仓库** 到您的GitHub账号

2. **配置 Secrets**：
   进入仓库 Settings → Secrets and variables → Actions → New repository secret

3. **添加以下必需参数**：

#### 基础配置
```env
# 自选股列表（逗号分隔）
STOCK_LIST=600519,300750,002594,000858

# AI模型选择（推荐Gemini，免费额度）
GEMINI_API_KEY=您的Gemini API Key
GEMINI_MODEL=gemini-3-flash-preview
```

#### 飞书机器人（推荐）
```env
# 获取方式：飞书群 → 设置 → 群机器人 → 添加 → 自定义机器人 → 复制Webhook地址
FEISHU_WEBHOOK_URL=https://open.feishu.cn/open-apis/bot/v2/hook/xxxxxxxxx
```

#### 飞书文档（进阶）
```env
# 获取方式详见下文"飞书应用配置"
FEISHU_APP_ID=cli_xxxxxxxxxxxxxxxx
FEISHU_APP_SECRET=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
FEISHU_FOLDER_TOKEN=Jzxxxxxxxxxxxxxxxx
```

### 第二步：飞书应用配置（可选）

如需创建详细文档报告，配置飞书应用：

1. **创建应用**：
   - 访问 [飞书开放平台](https://open.feishu.cn/)
   - 登录 → 开发者后台 → 创建应用
   - 应用类型：企业自建应用

2. **获取应用凭证**：
   - 进入应用管理 → 凭证与基础信息
   - 复制 App ID 和 App Secret

3. **设置机器人能力**：
   - 选择「机器人」→ 开启机器人能力
   - 权限配置：添加 docx:document 和 drive:drive:readonly 权限
   - 保存并发布

4. **创建文件夹Token**：
   - 在飞书云文档中创建专门存放分析报告的文件夹
   - 右键文件夹 → 属性 → 复制链接
   - 提取 URL 中的 token 部分（如：Jzxxxxxxxxxxxxxxxx）

### 第三步：本地运行配置（备用）

如需要本地定时运行：

1. **修改环境变量文件**：
```bash
cp .env.example .env
vim .env
```

2. **修改配置**：
```env
SCHEDULE_ENABLED=true
SCHEDULE_TIME=18:00
```

3. **运行定时任务**：
```bash
python scheduler.py
```

## 🧪 测试功能

使用提供的测试脚本验证功能：

```bash
# 测试飞书功能
python test_feishu.py

# 只运行分析（不推送）
python main.py --dry-run
```

## 🎨 推送效果预览

### 飞书机器人消息示例：
```
🎯 今日分析完成 - 2024-01-15

📈 大盘概览：
• 上证指数：+0.5% 三连阳 ✅
• 北向资金：+15.6亿 连续流入 ✅

🚀 个股决策：

600519 贵州茅台：✅ 持有
• 当前：¥1,688
• 趋势：MA多头排列 ✅
• 分摊：乖莲率 2.1% ✅
• 舆情：正面消息占70% ✅
• 建议：继续持有，目标价¥1,750

⚠️ 风险提示：市场波动加大，注意仓位控制
```

### 飞书文档示例：
- 📋 包含详细的个股分析报告
- 📊 完整的仪表盘数据
- 📈 可视化图表展示
- 📝 完整的AI决策理由

## 📊 运行时间

默认配置为每个工作日18:00（北京时间）自动运行：
- 📅 **时间**：周一到周五 18:00（北京时间）
- 🔄 **频率**：每个交易日运行一次
- 📊 **内容**：自选股分析 + 大盘复盘

如需调整时间，修改工作流文件：
```yaml
schedule:
  - cron: '0 10 * * 1-5'  # UTC时间，北京时间-8小时
```

## ⚠️ 重要提示

1. **免费使用**：推荐使用Gemini AI（有免费额度）
2. **安全第一**：不要将API密钥泄露
3. **投资警示**：分析仅供学习参考，不构成投资建议
4. **知识扩展**：如需其他AI模型，可配置OpenAI兼容API

## 🆘 常见问题

### 1. 飞书推送失败？
- 检查Webhook URL是否正确
- 确认机器人是否在群聊中
- 检查网络连接状态

### 2. 文档创建失败？
- 确认应用权限是否配置正确
- 检查文件夹Token是否有效
- 查看是否超出API调用限制

### 3. AI分析结果异常？
- 确认API密钥有效
- 检查自选股代码是否正确
- 查看运行日志获取详细信息

## 📚 更多帮助

- 📖 详细文档：[README.md](README.md)
- 🐛 问题报告：[GitHub Issues](https://github.com/your-repo/issues)
- 💬 讨论交流：[GitHub Discussions](https://github.com/your-repo/discussions)

---

🎉 **配置完成后，您将每天收到智能的股票分析报告！**